% +--------------------------------------------------------------------+
% | Appendix A Page (Optional)                                         |
% +--------------------------------------------------------------------+

\cleardoublepage

\chapter{Guía de instalación para el servidor}
\label{Appendix:Key1}

\section{Docker}
\label{makereference7.1}
Esta es una guía para el despliegue del servidor en Docker.

El repositorio del proyecto del servidor se encuentra en:
\url{https://github.com/ZReKoJ/Docker.git}

Para ello primero tenemos que tener docker instalado, el cual 
se puede instalar por el siguiente enlace \url{https://www.docker.com/}

Se han creado dos imágenes tras la ejecución, la de ubuntu es una dependencia usada, para tener el entorno de Linux, por eso no se puede borrar.

Tras descargarse el repositorio, mediante commando, situarse en la carpeta raíz del proyecto.

\begin{lstlisting}[language=bash, caption=Levantamiento de la instancia de docker]
    docker-compose up
\end{lstlisting}

Con la sentecia \textbf{docker-compose up} se despliega la instancia de docker con las configuraciones 
que están en el archivo docker-compose.yml.

\begin{figure}[H]
    \centering
    \includegraphics[width=6in]{figures/appendix-A/list-docker-containers.png}
    \caption{La instancia de docker levantada}
\end{figure}

Ahora que se ha levantado la instancia de docker y sus respectivos puertos mapeados.
Se conecta al container mediante ssh con la contraseña \textbf{tfg-ucm}

\begin{lstlisting}[language=bash, caption=Conexión ssh]
    # El puerto 22022 es el que se habia mapeado
    ssh root@localhost -p 22022
\end{lstlisting}

Una vez conectado al container, hay que ir a la ruta en el que se encuentra el proyecto: \url{/usr/src/app}

Antes de levantar el servicio, hay que preparar postgresql. El archivo SQL está dentro del proyecto
en el siguiente path: \url{/src/main/webapp/WEB-INF/sql/filmar_low.sql}. En la raíz del proyecto se 
encuentra un script llamado \textbf{database.sh}.

\begin{lstlisting}[language=bash, caption=Configuración postgresql]
    ./database.sh
\end{lstlisting}

Una vez configurado postgres, se procede al despliegue del servicio. Con \textbf{service.sh}.

\begin{lstlisting}[language=bash, caption=Despliegue]
    # Para parar el servicio
    ./service.sh start
    # Para reiniciar el servicio
    ./service.sh restart
    # Para parar el servicio
    ./service.sh
\end{lstlisting}

Ya está levantado el servicio en el puerto 8080, se puede probar con el siguiente enlace
\url{localhost:8080/films}.

\section{Heroku}
\label{makereference7.2}
Para comenzar debemos crear una cuenta en \href{https://www.heroku.com/}{Heroku}.
\begin{figure}[H]
    \centering
    \includegraphics[width=6in]{figures/chapter-4/heroku_1.png}
    \caption{Crear nueva aplicación en Heroku}
    \label{fig:heroku_1}
\end{figure}
Una vez tenemos una cuenta en la plataforma creamos una nueva aplicación a la cual daremos un nombre como vemos en la figura~\ref{fig:heroku_1} y este nombre a su vez será parte de la URL pública.
\begin{figure}[H]
    \centering
    \includegraphics[width=6in]{figures/chapter-4/heroku_2.png}
    \caption{Configuración de la aplicación}
    \label{fig:heroku_2}
\end{figure}
Cuando creemos la aplicación accederemos a la configuración en la que veremos opciones como en la figura~\ref{fig:heroku_2}.
\begin{figure}[H]
    \centering
    \includegraphics[width=6in]{figures/chapter-4/heroku_3.png}
    \caption{Métodos de despliegue}
    \label{fig:heroku_3}
\end{figure}
En la figura~\ref{fig:heroku_3} vemos que nos ofrece diversos métodos de despliegue:
\begin{itemize}
    \item Heroku Git
    \item GitHub
    \item Container Registry
\end{itemize}
Elegimos la opción de GitHub que nos proporciona un despliegue fácil y rápido. Tenemos que vincular la cuenta de nuestro GitHub (Importante ser el dueño del repositorio).
\begin{figure}[H]
    \centering
    \includegraphics[width=6in]{figures/chapter-4/heroku_4.png}
    \caption{Opciones de despliegue utilizando Github}
    \label{fig:heroku_4}
\end{figure}
Una vez vinculada la cuenta de GitHub tenemos dos métodos de despliegue como vemos en la figura~\ref{fig:heroku_4}. Un método automático para desplegar los cambios de una rama del repositorio que se accionará cada vez que subamos cambios y otro método manual que se desplegará sólo cuando presionemos el botón. 
Cuando elijamos una de las opciones, la aplicación estará lista para usarse.